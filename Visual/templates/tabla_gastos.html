<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <title>Lista de Gastos</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='Estilos/variables.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='Estilos/estilos.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='Estilos/gastos.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='Estilos/botonvol.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='Estilos/menu.css') }}" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    .contenedor-flex {
      display: flex;
      justify-content: flex-start;
      align-items: flex-start;
      gap: 20px;
      margin-top: 30px;
      margin-left: 40px;
    }

    .tabla-gastos {
      min-width: 700px;
      border-collapse: collapse;
    }

    .tabla-gastos th,
    .tabla-gastos td {
      border: 1px solid #217dbb;
      padding: 8px 12px;
      text-align: center;
    }

    .tabla-gastos th {
      background: #217dbb;
      color: #fff;
      font-weight: bold;
    }

    .grafico-box {
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 2px 8px #0001;
      padding: 20px;
      min-width: 400px;
      min-height: 350px;
    }

    .boton-agregar {
      display: block;
      width: 180px;
      margin: 25px 0 0 0;
      background: #217dbb;
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 12px 0;
      font-weight: bold;
      font-size: 16px;
      text-align: center;
      text-decoration: none;
      transition: background 0.2s;
    }

    .boton-agregar:hover {
      background: #155a8a;
    }
  </style>
</head>

<body>
  <!-- Men√∫ bot√≥n superior derecho -->
  <div class="menu-container">
    <button class="menu-button" onclick="toggleMenu()">‚ò∞ Men√∫</button>
    <div class="menu-opciones" id="menuOpciones">
      <a href="{{ url_for('tabla_gastos') }}">
        <button type="button">üí∏ Gastos</button>
      </a>
      <a href="{{ url_for('presupuesto') }}">
        <button type="button">üìä Presupuesto</button>
      </a>
      <a href="{{ url_for('principal') }}">
        <button type="button">üè† Principal</button>
      </a>
      <a href="{{ url_for('ingresos') }}"><button type="button">üí∞ Ingresos</button></a>
      <a href="{{ url_for('ver_deudas') }}"><button type="button">üßæ Ver Deudas</button></a>
      <a href="{{ url_for('logout') }}">
        <button type="button">üîí Cerrar sesi√≥n</button>
      </a>
    </div>
  </div>

  <div class="contenedor-flex">
    <div>
      <h2 style="color:#217dbb; margin-bottom: 18px;">üìã Lista de Gastos</h2>
      <table id="tablaGastos" class="tabla-gastos">
        <thead>
          <tr>
            <th>Fecha</th>
            <th>Descripci√≥n</th>
            <th>Categor√≠a</th>
            <th>Subcategor√≠a</th>
            <th>Valor</th>
          </tr>
        </thead>
        <tbody>
          {% for gasto in gastos %}
          <tr>
            <td>{{ gasto['Fecha'] }}</td>
            <td>{{ gasto['Descripcion'] }}</td>
            <td>{{ gasto['Categoria'] }}</td>
            <td>{{ gasto['Subcategoria'] }}</td>
            <td>{{ gasto['Valor'] }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      <!-- Bot√≥n para agregar nuevo gasto -->
      <a href="{{ url_for('gastos') }}" class="boton-agregar">Agregar nuevo gasto</a>
    </div>
    <div class="grafico-box">
      <h3 style="color:#217dbb; margin-bottom: 18px;">
        üìä Proporci√≥n de mis gastos
      </h3>
      <canvas id="graficoGastos"></canvas>
    </div>
  </div>

  <button class="boton-volver-fijo" onclick="window.location.href='{{ url_for('principal') }}'">
    <span class="icono-flecha">‚¨Ö</span> Volver a la principal
  </button>

  <script>
    function toggleMenu() {
      const menu = document.getElementById('menuOpciones');
      menu.style.display = menu.style.display === 'flex' ? 'none' : 'flex';
    }

    // Datos para el gr√°fico (usa descripci√≥n y valor)
    const labels = [
      {% for gasto in gastos %}
        "{{ gasto['Descripcion'] }}"{% if not loop.last %},{% endif %}
      {% endfor %}
    ];
    const data = [
      {% for gasto in gastos %}
        {{ gasto['Valor'] }}{% if not loop.last %},{% endif %}
      {% endfor %}
    ];
    const colores = [
      '#217dbb', '#2ca8e0', '#6ec1e4', '#b2dffb', '#f7b267', '#f4845f', '#f27059', '#b83b5e'
    ];

    const ctx = document.getElementById('graficoGastos').getContext('2d');
    new Chart(ctx, {
      type: 'pie',
      data: {
        labels: labels,
        datasets: [{
          data: data,
          backgroundColor: colores,
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: {
            position: 'bottom'
          }
        }
      }
    });
  </script>
</body>

</html>