<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <title>Registro de Gastos</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='Estilos/variables.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='Estilos/estilos.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='Estilos/gastos.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='Estilos/botonvol.css') }}" />
  <style>
    .layout-dos-columnas {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 60vh;
    }

    .columna-izquierda {
      width: 100%;
      max-width: 600px;
    }

    .formulario-login {
      width: 100%;
    }

    .grupo-botones {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-top: 25px;
    }

    .boton {
      width: 100%;
      text-align: center;
    }
  </style>
</head>

<body>
  <h1 style="text-align:center;">💸 Registro de Gastos</h1>

  <!-- Menú botón superior derecho -->
  <div class="layout-dos-columnas">
    <!-- Formulario de gastos -->
    <div class="columna-izquierda">
      <div class="formulario-login">
        <h2 class="titulo-login">🧾 Nuevo Gasto</h2>
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            {% for category, message in messages %}
              <div class="alert alert-{{ category }}">{{ message }}</div>
            {% endfor %}
          {% endif %}
        {% endwith %}
        <form id="formGasto" method="POST" action="{{ url_for('gastos') }}">
          <fieldset class="grupo-campos">
            <legend class="subtitulo">Información del gasto</legend>

            <label class="etiqueta" for="fecha">Fecha:</label>
            <input type="date" id="fecha" name="Fecha" class="campo-input" required>

            <label class="etiqueta" for="descripcion">Descripción:</label>
            <input type="text" id="descripcion" name="Descripcion" class="campo-input" required minlength="3" maxlength="30" pattern="^[A-Za-zÁÉÍÓÚáéíóúÑñ0-9\s.,-]+$" title="Solo letras, números y algunos símbolos. Mínimo 3 caracteres.">

            <label class="etiqueta" for="valor">Valor:</label>
            <input type="number" id="valor" name="Valor" class="campo-input" required min="1" max="100000000" step="any" title="Solo números positivos hasta 100.000.000.">

            <!-- Categoría -->
            <label class="etiqueta" for="categoria">Categoría:</label>
            <select id="categoria" name="Id_categoria" class="campo-input" required>
              <option value="">-- Selecciona una categoría --</option>
              {% for cat in categorias %}
                <option value="{{ cat['Id_categoria'] }}">{{ cat['Categoria_principal'] }}</option>
              {% endfor %}
            </select>

            <!-- Subcategoría -->
            <label class="etiqueta" for="subcategoria">Subcategoría:</label>
            <select id="subcategoria" name="Id_subcategoria" class="campo-input" required>
              <option value="">-- Selecciona una subcategoría --</option>
              {% for sub in subcategorias %}
                <option value="{{ sub['Id_subcategoria'] }}" data-categoria="{{ sub['Id_categoria'] }}">{{ sub['Nombre'] }}</option>
              {% endfor %}
            </select>
          </fieldset>

          <div class="grupo-botones">
            <button type="submit" class="boton">💾 Guardar gasto</button>
            <a href="{{ url_for('tabla_gastos') }}">
                        <button class="boton" type="button">Ver mis gastos</button>
            </a>
          </div>  
        </form>
      </div>
    </div>
  </div>
  <a href="{{ url_for('principal') }}">
    <button type="button" class="boton-volver-fijo">🏠 Principal</button>
  </a>
  <script>
    function toggleMenu() {
      const menu = document.getElementById('menuOpciones');
      menu.style.display = menu.style.display === 'flex' ? 'none' : 'flex';
    }
document.getElementById('categoria').addEventListener('change', function() {
  var categoriaId = this.value;
  var subcatSelect = document.getElementById('subcategoria');
  var options = subcatSelect.querySelectorAll('option[data-categoria]');
  subcatSelect.value = "";
  options.forEach(function(opt) {
    opt.style.display = (opt.getAttribute('data-categoria') === categoriaId) ? 'block' : 'none';
  });
});
window.addEventListener('DOMContentLoaded', function() {
  // Oculta todas las subcategorías al inicio
  var subcatSelect = document.getElementById('subcategoria');
  var options = subcatSelect.querySelectorAll('option[data-categoria]');
  options.forEach(function(opt) {
    opt.style.display = 'none';
  });
});
  </script>
  <script>
  // Evita escribir manualmente en el campo de fecha
  document.addEventListener('DOMContentLoaded', function() {
    var fechaInput = document.getElementById('fecha');
    fechaInput.addEventListener('keydown', function(e) {
      e.preventDefault();
    });
  });
</script>
<script>
document.getElementById('valor').addEventListener('input', function(e) {
  if (parseInt(this.value) > 100000000) {
    this.value = 100000000;
  }
});
</script>
</body>

</html>