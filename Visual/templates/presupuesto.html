<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <title>Registro de presupuesto</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='Estilos/variables.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='Estilos/estilos.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='Estilos/principal.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='Estilos/botonvol.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='Estilos/menu.css') }}" />
    <style>
        .layout-dos-columnas {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 60vh;
        }

        .columna-izquierda {
            width: 100%;
            max-width: 600px;
        }

        .formulario-login {
            width: 100%;
        }

        .grupo-botones {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 25px;
        }

        .boton {
            width: 100%;
            text-align: center;
        }
    </style>
</head>

<body>
    <!-- Men√∫ bot√≥n superior derecho -->
    <div class="menu-container">
        <button class="menu-button" onclick="toggleMenu()">‚ò∞ Men√∫</button>
        <div class="menu-opciones" id="menuOpciones">
            <a href="{{ url_for('principal') }}">
                <button type="button">üè†Principal</button>
            </a>
            <a href="{{ url_for('ingresos') }}">
                <button type="button">üí∞Ingresos</button>
            </a>
            <a href="{{ url_for('presupuesto') }}">
                <button type="button">üìäPresupuesto</button>
            </a>
            <a href="{{ url_for('tabla_gastos') }}">
                <button type="button">üí∏Gastos</button>
            </a>
            <a href="{{ url_for('ver_deudas') }}">
                <button type="button">üßæDeudas</button>
            </a>
            <a href="{{ url_for('logout') }}">
                <button type="button">üîíCerrar sesi√≥n</button>
            </a>
        </div>
    </div>

    <div class="layout-dos-columnas">
        <div class="columna-izquierda">
            <div class="formulario-login">
                <h2 class="titulo-login">Nuevo presupuesto mensual</h2>
                {% with messages = get_flashed_messages(with_categories=true) %}
                  {% if messages %}
                    {% for category, message in messages %}
                      <div class="alert alert-{{ category }}">{{ message }}</div>
                    {% endfor %}
                  {% endif %}
                {% endwith %}
                <form id="formPresupuesto" method="POST" action="{{ url_for('presupuesto') }}">
                    <!-- Informaci√≥n del per√≠odo -->
                    <fieldset class="grupo-campos">
                        <legend class="subtitulo">üóìÔ∏è Informaci√≥n del per√≠odo</legend>
                        <label class="etiqueta" for="presupuesto_periodo">Periodo:</label>
                        <input type="month" id="presupuesto_periodo" name="Periodo" class="campo-input" required>
                    </fieldset>

                    <!-- L√≠nea de presupuesto -->
                    <fieldset class="grupo-campos">
                        <legend class="subtitulo">üßæ L√≠nea de presupuesto</legend>

                        <label class="etiqueta" for="presupuesto_descripcion">Descripci√≥n:</label>
                        <input type="text" id="presupuesto_descripcion" name="Descripcion" class="campo-input" required>

                        <label class="etiqueta" for="presupuesto_fecha_pago">Fecha de pago:</label>
                        <input type="date" id="presupuesto_fecha_pago" name="Fecha_pago" class="campo-input" required>

                        <label class="etiqueta" for="presupuesto_categoria">Categor√≠a:</label>
                        <select id="presupuesto_categoria" name="Id_categoria" class="campo-input" required>
                            <option value="">-- Selecciona una categor√≠a --</option>
                            {% for cat in categorias %}
                                <option value="{{ cat['Id_categoria'] }}">{{ cat['Categoria_principal'] }}</option>
                            {% endfor %}
                        </select>

                        <label class="etiqueta" for="presupuesto_subcategoria">Subcategor√≠a:</label>
                        <select id="presupuesto_subcategoria" name="Id_subcategoria" class="campo-input" required>
                            <option value="">-- Selecciona una subcategor√≠a --</option>
                            {% for sub in subcategorias %}
                                <option value="{{ sub['Id_subcategoria'] }}" data-categoria="{{ sub['Id_categoria'] }}">{{ sub['Nombre'] }}</option>
                            {% endfor %}
                        </select>

                        <label class="etiqueta" for="presupuesto_tipo_gasto">Tipo de gasto:</label>
                        <select id="presupuesto_tipo_gasto" name="Tipo_gasto" class="campo-input" required>
                            <option value="Fijo">Fijo</option>
                            <option value="Variable">Variable</option>
                        </select>

                        <label class="etiqueta" for="presupuesto_valor">Valor estimado:</label>
                        <input type="number" id="presupuesto_valor" name="Valor" class="campo-input" required>
                    </fieldset>

                    <div class="grupo-botones">
                        <button type="submit" class="boton">üíæ Guardar presupuesto</button>
                        <a href="{{ url_for('tabla_presupuesto') }}">
                            <button type="button" class="boton">üìä Ver resumen de presupuesto</button>
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <a href="{{ url_for('principal') }}">
        <button type="button" class="boton-volver-fijo">üè† Principal</button>
    </a>
    <script>
        function toggleMenu() {
            const menu = document.getElementById('menuOpciones');
            menu.style.display = menu.style.display === 'flex' ? 'none' : 'flex';
        }
    </script>
    <script>
document.getElementById('presupuesto_categoria').addEventListener('change', function() {
    var categoriaId = this.value;
    var subcatSelect = document.getElementById('presupuesto_subcategoria');
    var options = subcatSelect.querySelectorAll('option[data-categoria]');
    subcatSelect.value = "";
    options.forEach(function(opt) {
        opt.style.display = (opt.getAttribute('data-categoria') === categoriaId) ? 'block' : 'none';
    });
});
// Oculta todas las subcategor√≠as al cargar
window.addEventListener('DOMContentLoaded', function() {
    var subcatSelect = document.getElementById('presupuesto_subcategoria');
    var options = subcatSelect.querySelectorAll('option[data-categoria]');
    options.forEach(function(opt) {
        opt.style.display = 'none';
    });
});
</script>
</body>

</html>