<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <title>Registro de deudas</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='Estilos/variables.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='Estilos/estilos.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='Estilos/botonvol.css') }}" />
</head>

<body>
    <div class="contenedor-central">
        <div class="formulario-login">
            <h2 class="titulo-login">REGISTRO DE DEUDAS</h2>
            <form method="POST" action="{{ url_for('deudas') }}">
                <label class="etiqueta" for="descripcion">Descripción:</label>
                <input type="text" id="descripcion" name="descripcion" class="campo-input" required />

                <label class="etiqueta" for="entidad">Entidad:</label>
                <input type="text" id="entidad" name="Entidad" class="campo-input" required />

                <label class="etiqueta" for="valor">Valor actual:</label>
                <input type="number" id="valor" name="Valor_actual" class="campo-input" required min="1" step="0.01" />

                <label class="etiqueta" for="valor_cuota">Valor de la cuota:</label>
                <input type="number" id="valor_cuota" name="Valor_cuota" class="campo-input" required min="1" step="0.01" />

                <label class="etiqueta" for="cuotas">Cuotas pendientes:</label>
                <input type="number" id="cuotas" name="Cuotas_pendientes" class="campo-input" required min="1" />

                <label class="etiqueta" for="interes">Interés (%):</label>
                <input type="number" id="interes" name="Interes" class="campo-input" required min="0" step="0.01" />

                <label class="etiqueta" for="Id_categoria">Categoría:</label>
                <select id="Id_categoria" name="Id_categoria" class="campo-input" required>
                    {% for cat in categorias %}
                        {% if cat['Id_categoria'] == 11 %}
                            <option value="{{ cat['Id_categoria'] }}">{{ cat['Categoria_principal'] }}</option>
                        {% endif %}
                    {% endfor %}
                </select>

                <label class="etiqueta" for="Id_subcategoria">Subcategoría:</label>
                <select id="Id_subcategoria" name="Id_subcategoria" class="campo-input" required>
                    <option value="">-- Selecciona una subcategoría --</option>
                    {% for sub in subcategorias %}
                        {% if sub['Id_categoria'] == 11 %}
                            <option value="{{ sub['Id_subcategoria'] }}">{{ sub['Nombre'] }}</option>
                        {% endif %}
                    {% endfor %}
                </select>

                <div class="grupo-botones">
                    <button class="boton" type="submit">Guardar</button>
                    <a href="{{ url_for('deudas', nuevo=1) }}">
                        <button class="boton" type="button">Agregar nueva</button>
                    </a>
                    <a href="{{ url_for('ver_deudas') }}">
                        <button class="boton" type="button">Ver mis deudas</button>
                    </a>
                </div>
            </form>
            {% with messages = get_flashed_messages() %}
              {% if messages %}
                <ul class="flashes">
                  {% for message in messages %}
                    <li>{{ message }}</li>
                  {% endfor %}
                </ul>
              {% endif %}
            {% endwith %}
        </div>
    </div>

    <button class="boton-volver-fijo" onclick="window.location.href={{ url_for('ingresos')|tojson }}">
        <span class="icono-flecha">⬅</span> Volver a la principal
    </button>

    <script>
    document.getElementById('Id_categoria').addEventListener('change', function() {
        var categoriaId = this.value;
        var subcatSelect = document.getElementById('Id_subcategoria');
        var options = subcatSelect.querySelectorAll('option[data-categoria]');
        subcatSelect.value = "";
        options.forEach(function(opt) {
            opt.style.display = (opt.getAttribute('data-categoria') === categoriaId) ? 'block' : 'none';
        });
    });
    window.addEventListener('DOMContentLoaded', function() {
        var subcatSelect = document.getElementById('Id_subcategoria');
        var options = subcatSelect.querySelectorAll('option[data-categoria]');
        options.forEach(function(opt) {
            opt.style.display = 'none';
        });
    });
    </script>
</body>

</html>