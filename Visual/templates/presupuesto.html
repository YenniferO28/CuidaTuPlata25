<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <title>Registro de presupuesto</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='Estilos/variables.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='Estilos/estilos.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='Estilos/principal.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='Estilos/botonvol.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='Estilos/menu.css') }}" />
    <style>
        .layout-dos-columnas {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 60vh;
        }

        .columna-izquierda {
            width: 100%;
            max-width: 600px;
        }

        .formulario-login {
            width: 100%;
        }

        .grupo-botones {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 25px;
        }

        .boton {
            width: 100%;
            text-align: center;
        }
    </style>
</head>

<body>
    <!-- Menú botón superior derecho -->
    <div class="menu-container">
        <button class="menu-button" onclick="toggleMenu()">☰ Menú</button>
        <div class="menu-opciones" id="menuOpciones">
            <a href="{{ url_for('principal') }}">
                <button type="button">🏠Principal</button>
            </a>
            <a href="{{ url_for('ingresos') }}">
                <button type="button">💰Ingresos</button>
            </a>
            <a href="{{ url_for('presupuesto') }}">
                <button type="button">📊Presupuesto</button>
            </a>
            <a href="{{ url_for('tabla_gastos') }}">
                <button type="button">💸Gastos</button>
            </a>
            <a href="{{ url_for('ver_deudas') }}">
                <button type="button">🧾Deudas</button>
            </a>
            <a href="{{ url_for('logout') }}">
                <button type="button">🔒Cerrar sesión</button>
            </a>
        </div>
    </div>

    <div class="layout-dos-columnas">
        <div class="columna-izquierda">
            <div class="formulario-login">
                <h2 class="titulo-login">Nuevo presupuesto mensual</h2>
                {% with messages = get_flashed_messages(with_categories=true) %}
                  {% if messages %}
                    {% for category, message in messages %}
                      <div class="alert alert-{{ category }}">{{ message }}</div>
                    {% endfor %}
                  {% endif %}
                {% endwith %}
                <form id="formPresupuesto" method="POST" action="{{ url_for('presupuesto') }}">
                    <!-- Información del período -->
                    <fieldset class="grupo-campos">
                        <legend class="subtitulo">🗓️ Información del período</legend>
                        <label class="etiqueta" for="presupuesto_periodo">Periodo:</label>
                        <input type="month" id="presupuesto_periodo" name="Periodo" class="campo-input" required />

                        <label class="etiqueta" for="presupuesto_descripcion">Descripción:</label>
                        <input 
                            type="text" 
                            id="presupuesto_descripcion" 
                            name="Descripcion" 
                            class="campo-input" 
                            required 
                            minlength="3" 
                            maxlength="30"
                            pattern="^[A-Za-zÁÉÍÓÚáéíóúÑñ0-9\s.,-]+$"
                            title="Solo letras, números y algunos símbolos. Mínimo 3 caracteres."
                        />

                        <label class="etiqueta" for="presupuesto_fecha_pago">Fecha de pago:</label>
                        <input type="date" id="presupuesto_fecha_pago" name="Fecha_pago" class="campo-input" required />

                        <label class="etiqueta" for="presupuesto_categoria">Categoría:</label>
                        <select id="presupuesto_categoria" name="Id_categoria" class="campo-input" required>
                            <option value="">-- Selecciona una categoría --</option>
                            {% for cat in categorias %}
                                <option value="{{ cat['Id_categoria'] }}">{{ cat['Categoria_principal'] }}</option>
                            {% endfor %}
                        </select>

                        <label class="etiqueta" for="presupuesto_subcategoria">Subcategoría:</label>
                        <select id="presupuesto_subcategoria" name="Id_subcategoria" class="campo-input" required>
                            <option value="">-- Selecciona una subcategoría --</option>
                            {% for sub in subcategorias %}
                                <option value="{{ sub['Id_subcategoria'] }}" data-categoria="{{ sub['Id_categoria'] }}">{{ sub['Nombre'] }}</option>
                            {% endfor %}
                        </select>

                        <label class="etiqueta" for="presupuesto_tipo_gasto">Tipo de gasto:</label>
                        <select id="presupuesto_tipo_gasto" name="Tipo_gasto" class="campo-input" required>
                            <option value="Fijo">Fijo</option>
                            <option value="Variable">Variable</option>
                        </select>

                        <label class="etiqueta" for="presupuesto_valor">Valor estimado:</label>
                        <input 
                            type="number" 
                            id="presupuesto_valor" 
                            name="Valor" 
                            class="campo-input" 
                            required 
                            min="1" 
                            max="100000000" 
                            step="0.01"
                            title="Solo números positivos hasta 100.000.000"
                        />
                    </fieldset>

                    <div class="grupo-botones">
                        <button type="submit" class="boton">💾 Guardar presupuesto</button>
                        <a href="{{ url_for('tabla_presupuesto') }}">
                            <button type="button" class="boton">📊 Ver resumen de presupuesto</button>
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <a href="{{ url_for('principal') }}">
        <button type="button" class="boton-volver-fijo">🏠 Principal</button>
    </a>
    <script>
        function toggleMenu() {
            const menu = document.getElementById('menuOpciones');
            menu.style.display = menu.style.display === 'flex' ? 'none' : 'flex';
        }
    </script>
    <script>
document.getElementById('presupuesto_categoria').addEventListener('change', function() {
    var categoriaId = this.value;
    var subcatSelect = document.getElementById('presupuesto_subcategoria');
    var options = subcatSelect.querySelectorAll('option[data-categoria]');
    subcatSelect.value = "";
    options.forEach(function(opt) {
        opt.style.display = (opt.getAttribute('data-categoria') === categoriaId) ? 'block' : 'none';
    });
});
// Oculta todas las subcategorías al cargar
window.addEventListener('DOMContentLoaded', function() {
    var subcatSelect = document.getElementById('presupuesto_subcategoria');
    var options = subcatSelect.querySelectorAll('option[data-categoria]');
    options.forEach(function(opt) {
        opt.style.display = 'none';
    });
});
document.getElementById('presupuesto_periodo').addEventListener('keydown', function(e) {
    e.preventDefault();
});
document.getElementById('presupuesto_fecha_pago').addEventListener('keydown', function(e) {
    e.preventDefault();
});
document.getElementById('presupuesto_valor').addEventListener('input', function() {
    if (parseFloat(this.value) > 100000000) {
        this.value = 100000000;
    }
});
</script>
</body>

</html>